<!--pages/share/share.wxml-->
<view class="container">
  <!-- æœªç™»å½•æç¤º -->
  <view class="login-tip" wx:if="{{!isLogin}}">
    <text class="tip-icon">ğŸ</text>
    <text class="tip-text">è¯·å…ˆé¢†å–ç¤¼å“ï¼Œå†æ¥åˆ†äº«</text>
    <button class="btn-go-claim" bindtap="goToIndex">å»é¢†å–</button>
  </view>

  <!-- å·²ç™»å½• - åˆ†äº«æ•°æ® -->
  <view wx:if="{{isLogin}}">
    <!-- é‚€è¯·ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-card card">
      <view class="stats-header">
        <text class="stats-title">ğŸ‰ å·²æˆåŠŸé‚€è¯·</text>
        <text class="stats-count">{{shareStats.total_invites}}</text>
        <text class="stats-unit">äºº</text>
      </view>

      <!-- è¿›åº¦æ¡ -->
      <view class="progress-section">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{progressPercent}}%"></view>
        </view>
        <view class="progress-text">
          å†é‚€è¯· {{nextGift.required - shareStats.total_invites}} äººè§£é” {{nextGift.name}}
        </view>
      </view>

      <!-- ä»Šæ—¥æ•°æ® -->
      <view class="today-stats">
        <text>ä»Šæ—¥æ–°å¢ï¼š{{shareStats.today_invites}} äºº</text>
      </view>
    </view>

    <!-- ç¤¼å“è§£é”è¿›åº¦ -->
    <view class="gifts-card card">
      <view class="section-title">ç¤¼å“è§£é”è¿›åº¦</view>

      <view class="gift-progress-list">
        <view
          class="gift-progress-item {{item.status}}"
          wx:for="{{giftList}}"
          wx:key="level"
        >
          <view class="gift-status-icon">
            <text wx:if="{{item.status === 'claimed'}}">âœ…</text>
            <text wx:elif="{{item.status === 'unlocked'}}">ğŸ</text>
            <text wx:else>ğŸ”’</text>
          </view>

          <view class="gift-info">
            <text class="gift-name">{{item.name}}</text>
            <text class="gift-require">{{item.requireText}}</text>
          </view>

          <view class="gift-action">
            <button
              class="btn-claim-gift"
              wx:if="{{item.status === 'unlocked'}}"
              bindtap="claimGift"
              data-level="{{item.level}}"
            >
              é¢†å–
            </button>
            <text class="status-text" wx:elif="{{item.status === 'claimed'}}">å·²é¢†å–</text>
            <text class="status-text locked" wx:else>è¿˜å·®{{item.remaining}}äºº</text>
          </view>
        </view>
      </view>
    </view>

    <!-- é‚€è¯·è®°å½• -->
    <view class="invitees-card card">
      <view class="section-title">
        é‚€è¯·è®°å½•
        <text class="record-count">å…± {{shareStats.total_invites}} äºº</text>
      </view>

      <view class="invitee-list" wx:if="{{inviteeList.length > 0}}">
        <view class="invitee-item" wx:for="{{inviteeList}}" wx:key="id">
          <image class="invitee-avatar" src="{{item.avatar || '/images/default-avatar.png'}}"></image>
          <view class="invitee-info">
            <text class="invitee-name">{{item.nickname}}</text>
            <text class="invitee-phone">{{item.phone}}</text>
          </view>
          <text class="invitee-time">{{item.created_at}}</text>
        </view>
      </view>

      <view class="empty-list" wx:else>
        <text>æš‚æ— é‚€è¯·è®°å½•ï¼Œå¿«å»åˆ†äº«å§</text>
      </view>
    </view>

    <!-- åˆ†äº«æŒ‰é’® -->
    <view class="share-btn-area">
      <button class="btn-share-main" open-type="share">
        ğŸ“¤ åˆ†äº«ç»™å¥½å‹èµšç¤¼å“
      </button>
    </view>
  </view>
</view>
